modules:
  - name: data-server
    type: httpserver.modular
    config:
      address: ":8086"
  - name: data-auth
    type: auth.modular
    config:
      enableJWT: true
      enableApiKey: false
  - name: data-cache
    type: cache.modular
    config:
      defaultTTL: "2h"
      cleanupInterval: "15m"
  - name: data-database
    type: database.modular
    config:
      driver: sqlite
      dsn: ":memory:"
  - name: data-scheduler
    type: scheduler.modular
    config:
      timezone: "UTC"
  - name: data-eventbus
    type: eventbus.modular
  - name: data-logger
    type: eventlogger.modular
  - name: data-schema
    type: jsonschema.modular
  - name: data-ingestion-api
    type: api.handler
    config:
      resourceName: "data"
  - name: data-validator
    type: messaging.handler
  - name: data-transformer
    type: messaging.handler
  - name: data-aggregator
    type: messaging.handler
  - name: batch-processor
    type: messaging.handler

workflows:
  http:
    routes:
      - method: POST
        path: /api/data/upload
        handler: data-ingestion-api
      - method: GET
        path: /api/data/status/:id
        handler: data-ingestion-api
      - method: GET
        path: /api/data/results/:id
        handler: data-ingestion-api
  messaging:
    subscriptions:
      - topic: data.uploaded
        handler: data-validator
      - topic: data.validated
        handler: data-transformer
      - topic: data.transformed
        handler: data-aggregator
    producers:
      - name: data-ingestion-api
        forwardTo: [data.uploaded]
      - name: data-validator
        forwardTo: [data.validated]
      - name: data-transformer
        forwardTo: [data.transformed]
      - name: data-aggregator
        forwardTo: [data.processed]
  scheduler:
    jobs:
      - scheduler: data-scheduler
        job: batch-processor
        schedule: "0 */2 * * *"
# Configuration sections for modular modules
auth:
  JWT:
    Secret: "test-jwt-secret-key"
    Expiration: "24h"

cache:
  defaultTTL: "1h"
  cleanupInterval: "10m"
  maxItems: 10000

database:
  driver: sqlite
  dsn: ":memory:"

scheduler:
  timezone: "UTC"
  maxConcurrentJobs: 10

httpserver:
  address: ":8080"
  enableGracefulShutdown: true
