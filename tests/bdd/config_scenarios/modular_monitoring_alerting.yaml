modules:
  - name: monitoring-server
    type: httpserver.modular
    config:
      address: ":8090"
  - name: monitoring-auth
    type: auth.modular
  - name: metrics-cache
    type: cache.modular
  - name: metrics-database
    type: database.modular
  - name: alert-scheduler
    type: scheduler.modular
  - name: metrics-eventbus
    type: eventbus.modular
  - name: system-logger
    type: eventlogger.modular
  - name: external-client
    type: httpclient.modular
  - name: alert-schema
    type: jsonschema.modular
  - name: metrics-api
    type: api.handler
    config:
      resourceName: "metrics"
  - name: alerts-api
    type: api.handler
    config:
      resourceName: "alerts"
  - name: metrics-collector
    type: messaging.handler
  - name: alert-evaluator
    type: messaging.handler
  - name: notification-dispatcher
    type: messaging.handler

workflows:
  http:
    routes:
      - method: POST
        path: /api/metrics
        handler: metrics-api
      - method: GET
        path: /api/metrics
        handler: metrics-api
      - method: GET
        path: /api/alerts
        handler: alerts-api
      - method: POST
        path: /api/alerts/acknowledge
        handler: alerts-api
  messaging:
    subscriptions:
      - topic: metrics.received
        handler: metrics-collector
      - topic: metrics.processed
        handler: alert-evaluator
      - topic: alert.triggered
        handler: notification-dispatcher
    producers:
      - name: metrics-api
        forwardTo: [metrics.received]
      - name: metrics-collector
        forwardTo: [metrics.processed]
      - name: alert-evaluator
        forwardTo: [alert.triggered]
  scheduler:
    jobs:
      - scheduler: alert-scheduler
        job: health-check
        schedule: "*/1 * * * *"
      - scheduler: alert-scheduler
        job: metric-cleanup
        schedule: "0 0 * * *"
# Configuration sections for modular modules
auth:
  JWT:
    Secret: "test-jwt-secret-key"
    Expiration: "24h"

cache:
  defaultTTL: "1h"
  cleanupInterval: "10m"
  maxItems: 10000

database:
  driver: sqlite
  dsn: ":memory:"

scheduler:
  timezone: "UTC"
  maxConcurrentJobs: 10

httpserver:
  address: ":8080"
  enableGracefulShutdown: true
